<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <title>Middle-earth Manager v6.5 (Safe Mode)</title>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAcegclb9zUf2Yk1zi0qjNPvuI43uMsr-M",
          authDomain: "nazgul-campaign.firebaseapp.com",
          databaseURL: "https://nazgul-campaign-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "nazgul-campaign",
          storageBucket: "nazgul-campaign.firebasestorage.app",
          messagingSenderId: "931612776136",
          appId: "1:931612776136:web:091524d064d792e9bc77fd",
          measurementId: "G-7417E5KS9W"
        };

        const app = initializeApp(firebaseConfig);
        window.db = getDatabase(app);
        window.dbRef = ref; window.dbSet = set; window.dbOnValue = onValue; window.dbPush = push;
        console.log("Firebase OK");
    </script>

    <style>
        body { background-color: #202020; color: #d4af37; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* KARTTA-ALUE */
        #viewport { flex: 3; position: relative; background: #111; overflow: hidden; cursor: grab; display: flex; align-items: center; justify-content: center; }
        #viewport:active { cursor: grabbing; }

        /* SIVUPALKKI */
        #sidebar { flex: 1; min-width: 380px; background: #1a1a1a; border-left: 2px solid #444; padding: 20px; display: flex; flex-direction: column; z-index: 200; box-shadow: -10px 0 20px rgba(0,0,0,0.5); overflow-y: auto; }
        
        /* KARTTAELEMENTIT */
        #world { position: absolute; transform-origin: 0 0; display: none; }
        #game-map { display: block; pointer-events: none; user-select: none; }
        #svg-layer, #marker-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #svg-layer { z-index: 1; } #marker-layer { z-index: 2; }

        .marker { position: absolute; transform: translate(-50%, -100%); display: flex; flex-direction: column; align-items: center; cursor: pointer; pointer-events: auto; z-index: 100; }
        .pin { width: 14px; height: 14px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 0 5px #000; }
        .label { background: rgba(0,
